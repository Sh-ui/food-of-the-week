---
import type { Meal } from '../utils/readmeParser';

interface Props {
  meal: Meal;
}

const { meal } = Astro.props;
---

<div id={`print-section-${meal.id}`} class={`print-section section meal ${meal.cooked ? 'meal-cooked' : ''}`} data-section-type="meal" data-cooked={meal.cooked ? 'true' : 'false'}>
  <div class="meal-header">
    <span class={`cooked-indicator ${meal.cooked ? 'is-cooked' : ''}`} aria-label={meal.cooked ? 'Meal has been cooked' : 'Meal not yet cooked'}>
      {meal.cooked ? 'âœ“' : ''}
    </span>
    <h2>{meal.fullTitle}</h2>
    <button 
      class="button button-secondary print-button" 
      data-print-target={meal.id}
    >
      Print This Meal
    </button>
  </div>
  
  <div class="meal-details">
    {meal.protein && (
      <div class="meal-field">
        <strong>Protein:</strong> {meal.protein}
      </div>
    )}
    
    {meal.ingredients && (
      <div class="meal-field">
        <strong>Ingredients:</strong> {meal.ingredients}
      </div>
    )}
    
    {meal.description && (
      <div class="meal-field">
        <strong>Description:</strong> {meal.description}
      </div>
    )}
  </div>
  
  {/* Three-Phase Instructions */}
  {(meal.alreadyPrepped || meal.sousChef || meal.chefFinishing) ? (
    <div class="meal-instructions-phased">
      {meal.alreadyPrepped && meal.alreadyPrepped.length > 0 && (
        <div class="instruction-phase already-prepped">
          <h3>Already Prepped</h3>
          <ul>
            {meal.alreadyPrepped.map((item: string) => (
              <li>{item}</li>
            ))}
          </ul>
        </div>
      )}
      
      {meal.sousChef && (
        <div class="instruction-phase sous-chef">
          <h3>Sous Chef - Prep</h3>
          <div class="phase-content">
            {meal.sousChef.split('\n\n').map((paragraph: string) => (
              <p>{paragraph}</p>
            ))}
          </div>
        </div>
      )}
      
      {meal.chefFinishing && (
        <div class="instruction-phase chef-finishing">
          <h3>Chef - Finishing & Plating</h3>
          <div class="phase-content">
            {meal.chefFinishing.split('\n\n').map((paragraph: string) => (
              <p>{paragraph}</p>
            ))}
          </div>
        </div>
      )}
    </div>
  ) : meal.instructions && (
    <div class="meal-instructions">
      <h3>Instructions</h3>
      <div class="instructions-content">
        {meal.instructions.split('\n\n').map((paragraph: string) => (
          <p>{paragraph}</p>
        ))}
      </div>
    </div>
  )}
</div>

<style>
  .meal {
    break-inside: avoid;
  }

  .meal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-lg);
    gap: var(--spacing-md);
  }

  .meal-header h2 {
    margin: 0;
    flex: 1;
  }

  /* Cooked indicator - circular button next to heading */
  .cooked-indicator {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.75rem;
    height: 1.75rem;
    border: 2px solid var(--color-text-light, #6b6a62);
    border-radius: 50%;
    flex-shrink: 0;
    margin-top: 0.25rem;
    font-size: 0.9rem;
    color: transparent;
    cursor: default;
    user-select: none;
  }

  .cooked-indicator.is-cooked {
    background: var(--color-cooked-text, #8a887f);
    border-color: var(--color-cooked-text, #8a887f);
    color: white;
  }

  /* Greyed-out styling for cooked meals */
  .meal-cooked {
    background: var(--color-cooked-bg, #f0ede6);
    border-color: var(--color-cooked-border, #d8d4c9);
  }

  .meal-cooked .meal-header h2 {
    color: var(--color-cooked-text, #8a887f);
  }

  .meal-cooked .meal-details {
    background: var(--color-cooked-bg, #f0ede6);
    border-left-color: var(--color-cooked-border, #d8d4c9);
  }

  .meal-cooked .meal-field {
    color: var(--color-cooked-text, #8a887f);
  }

  .meal-cooked .meal-field strong {
    color: var(--color-cooked-text, #8a887f);
  }

  .meal-cooked .instruction-phase {
    background: var(--color-cooked-bg, #f0ede6);
    border-left-color: var(--color-cooked-border, #d8d4c9);
  }

  .meal-cooked .instruction-phase h3 {
    color: var(--color-cooked-text, #8a887f);
  }

  .meal-cooked .instruction-phase li,
  .meal-cooked .phase-content p {
    color: var(--color-cooked-text, #8a887f);
  }

  .meal-cooked .meal-instructions h3 {
    color: var(--color-cooked-text, #8a887f);
  }

  .meal-cooked .instructions-content p {
    color: var(--color-cooked-text, #8a887f);
  }

  .meal-details {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    padding: var(--spacing-md);
    background: var(--color-bg-alt);
    border-radius: 6px;
    border-left: 4px solid var(--color-secondary);
  }

  .meal-field {
  line-height: 1.68;
  font-size: 1.1rem;
  }

  .meal-field strong {
    color: var(--color-primary);
    display: inline-block;
    min-width: 120px;
  }

  .meal-instructions {
    margin-top: var(--spacing-lg);
  }

  /* Legacy instructions format */
  .meal-instructions h3 {
    color: var(--color-primary);
    margin-bottom: var(--spacing-md);
  }

  .instructions-content p {
    margin-bottom: var(--spacing-md);
    line-height: 1.6;
  }

  .meal-instructions :global(p) {
    margin-bottom: var(--spacing-md);
  }

  .meal-instructions :global(ul),
  .meal-instructions :global(ol) {
    margin-left: var(--spacing-lg);
    margin-bottom: var(--spacing-md);
  }

  .meal-instructions :global(li) {
    margin-bottom: var(--spacing-sm);
  }

  /* Three-phase instructions format */
  .meal-instructions-phased {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xl);
    margin-top: var(--spacing-lg);
  }

  .instruction-phase {
    padding: var(--spacing-md);
    border-radius: 6px;
    border-left: 4px solid;
  }

  .instruction-phase h3 {
    margin-top: 0;
    margin-bottom: var(--spacing-md);
  font-size: 1.25rem;
    font-weight: 600;
  }

  .instruction-phase ul {
    list-style: disc;
    margin-left: var(--spacing-lg);
  }

  .instruction-phase li {
  margin-bottom: var(--spacing-sm);
  line-height: 1.68;
  font-size: 1.1rem;
  }

  .phase-content p {
  margin-bottom: var(--spacing-md);
  line-height: 1.68;
  font-size: 1.1rem;
  }

  .phase-content p:last-child {
    margin-bottom: 0;
  }

  /* Already Prepped - Sweet Salmon (soft reference) */
  .already-prepped {
    background: #fef5f2;
    border-left-color: #D78A76;
  }

  .already-prepped h3 {
    color: #b86d5c;
  }

  /* Sous Chef - Tuscan Sun (bright prep work) */
  .sous-chef {
    background: #fef9e8;
    border-left-color: #F3CA40;
  }

  .sous-chef h3 {
    color: #c9a22d;
  }

  /* Chef Finishing - Tangerine Dream (bold action) */
  .chef-finishing {
    background: #fff5ef;
    border-left-color: #F08A4B;
  }

  .chef-finishing h3 {
    color: #d16d2f;
  }

  @media (max-width: 768px) {
    .meal-header {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--spacing-md);
    }

    .cooked-indicator {
      width: 2rem;
      height: 2rem;
      font-size: 1rem;
    }
    
    .meal-header h2 {
    font-size: 2rem;
    }

    .meal-field {
    font-size: 1.25rem;
    line-height: 1.75;
    }

    .meal-field strong {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-size: 1.25rem;
    }
    
    .instruction-phase {
      padding: var(--spacing-lg);
    }
    
    .instruction-phase h3 {
    font-size: 1.3rem;
      margin-bottom: var(--spacing-md);
    }
    
    .instruction-phase li,
    .phase-content p {
    font-size: 1.25rem;
    line-height: 1.75;
    }
    
    .meal-instructions h3 {
      font-size: 1.375rem;
    }
    
    .instructions-content p {
    font-size: 1.25rem;
    line-height: 1.75;
    }
  }
</style>

