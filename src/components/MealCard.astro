---
import type { Meal } from '../utils/readmeParser';
import { marked } from 'marked';

interface Props {
  meal: Meal;
}

const { meal } = Astro.props;

// Convert markdown content to HTML for rendering
const contentHtml = marked.parse(meal.content);
---

<div id={`print-section-${meal.id}`} class="print-section section meal" data-section-type="meal">
  <div class="meal-header">
    <h2>{meal.fullTitle}</h2>
    <button 
      class="button button-secondary print-button" 
      data-print-target={meal.id}
    >
      üñ®Ô∏è Print This Meal
    </button>
  </div>
  
  <div class="meal-details">
    {meal.protein && (
      <div class="meal-field">
        <strong>Protein:</strong> {meal.protein}
      </div>
    )}
    
    {meal.ingredients && (
      <div class="meal-field">
        <strong>Ingredients:</strong> {meal.ingredients}
      </div>
    )}
    
    {meal.description && (
      <div class="meal-field">
        <strong>Description:</strong> {meal.description}
      </div>
    )}
  </div>
  
  {meal.instructions && (
    <div class="meal-instructions">
      <h3>Instructions</h3>
      <div set:html={marked.parse(meal.instructions)} />
    </div>
  )}
  
  <div class="meal-content" set:html={contentHtml} />
</div>

<style>
  .meal {
    break-inside: avoid;
  }

  .meal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-lg);
    gap: var(--spacing-md);
  }

  .meal-header h2 {
    margin: 0;
    flex: 1;
  }

  .meal-details {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    padding: var(--spacing-md);
    background: var(--color-bg-alt);
    border-radius: 6px;
    border-left: 4px solid var(--color-secondary);
  }

  .meal-field {
    line-height: 1.6;
  }

  .meal-field strong {
    color: var(--color-primary);
    display: inline-block;
    min-width: 120px;
  }

  .meal-instructions {
    margin-top: var(--spacing-lg);
  }

  .meal-instructions h3 {
    color: var(--color-primary);
    margin-bottom: var(--spacing-md);
  }

  .meal-content {
    color: var(--color-text);
  }

  .meal-content :global(p) {
    margin-bottom: var(--spacing-md);
  }

  .meal-content :global(ul),
  .meal-content :global(ol) {
    margin-left: var(--spacing-lg);
    margin-bottom: var(--spacing-md);
  }

  .meal-content :global(li) {
    margin-bottom: var(--spacing-sm);
  }

  .meal-content :global(strong) {
    color: var(--color-primary);
  }

  @media (max-width: 768px) {
    .meal-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .meal-field strong {
      display: block;
      margin-bottom: var(--spacing-xs);
    }
  }
</style>

